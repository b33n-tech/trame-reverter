<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Trame Académique Non Linéaire</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 40px;
  background: #f5f5f5;
}
h1 {
  text-align: center;
}
#inputSection {
  margin-bottom: 20px;
}
textarea {
  width: 100%;
  height: 100px;
  padding: 10px;
  font-size: 16px;
}
button {
  margin: 10px 5px 10px 0;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}
#output {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.box {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.15);
  cursor: grab;
  user-select: none;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.box.dragging {
  opacity: 0.5;
}
.box span {
  flex: 1;
  margin-right: 10px;
}
.box input {
  flex: 1;
  font-size: 16px;
}
.deleteBtn {
  background: #e74c3c;
  border: none;
  color: #fff;
  padding: 5px 10px;
  border-radius: 5px;
  cursor: pointer;
}
</style>
</head>
<body>

<h1>Trame Académique Non Linéaire</h1>

<div id="inputSection">
  <p>Écris tes points dans l'ordre "à rebours" :</p>
  <textarea id="input"></textarea><br>
  <button onclick="invertOrder()">Réorganiser à l'endroit</button>
  <button onclick="addBox()">Ajouter un argument</button>
  <button onclick="clearAll()">Tout effacer</button>
</div>

<h2>Trame organisée :</h2>
<div id="output"></div>

<script>
const output = document.getElementById('output');

// Inversion automatique
function invertOrder() {
  const input = document.getElementById('input').value;
  const lines = input.split('\n').filter(line => line.trim() !== '');
  const reversed = lines.reverse();
  renderBoxes(reversed);
  document.getElementById('input').value = '';
}

// Ajouter box manuellement
function addBox(text='Nouvel argument') {
  renderBoxes([text], true);
}

// Effacer tout
function clearAll() {
  output.innerHTML = '';
}

// Créer les boxes
function renderBoxes(lines, append=false) {
  if(!append) output.innerHTML = '';
  lines.forEach((line) => {
    const div = document.createElement('div');
    div.className = 'box';
    div.draggable = true;

    const span = document.createElement('span');
    span.textContent = line;
    span.addEventListener('dblclick', () => editBox(span));

    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'deleteBtn';
    deleteBtn.textContent = '×';
    deleteBtn.onclick = () => div.remove();

    div.appendChild(span);
    div.appendChild(deleteBtn);
    makeDraggable(div);

    output.appendChild(div);
  });
  updateNumbering();
}

// Éditer directement la box
function editBox(span) {
  const input = document.createElement('input');
  input.value = span.textContent;
  span.replaceWith(input);
  input.focus();
  input.addEventListener('blur', () => {
    span.textContent = input.value;
    input.replaceWith(span);
  });
  input.addEventListener('keydown', (e) => {
    if(e.key==='Enter') input.blur();
  });
}

// Drag & Drop
let dragged = null;

function makeDraggable(element) {
  element.addEventListener('dragstart', (e) => {
    dragged = element;
    element.classList.add('dragging');
  });
  element.addEventListener('dragend', (e) => {
    dragged = null;
    element.classList.remove('dragging');
    updateNumbering();
  });
  element.addEventListener('dragover', (e) => {
    e.preventDefault();
    const bounding = element.getBoundingClientRect();
    const offset = e.clientY - bounding.top;
    if(offset > bounding.height / 2){
      element.style['border-bottom'] = '2px solid #000';
      element.style['border-top'] = '';
    } else {
      element.style['border-top'] = '2px solid #000';
      element.style['border-bottom'] = '';
    }
  });
  element.addEventListener('dragleave', (e) => {
    element.style['border-top'] = '';
    element.style['border-bottom'] = '';
  });
  element.addEventListener('drop', (e) => {
    e.preventDefault();
    if(dragged && dragged !== element){
      const bounding = element.getBoundingClientRect();
      const offset = e.clientY - bounding.top;
      if(offset > bounding.height / 2){
        element.style['border-bottom'] = '';
        element.parentNode.insertBefore(dragged, element.nextSibling);
      } else {
        element.style['border-top'] = '';
        element.parentNode.insertBefore(dragged, element);
      }
      updateNumbering();
    }
  });
}

// Numérotation dynamique
function updateNumbering() {
  Array.from(output.children).forEach((box, index) => {
    const span = box.querySelector('span');
    span.textContent = `[${index+1}] ${span.textContent.replace(/^\[\d+\]\s*/, '')}`;
  });
}
</script>

</body>
</html>
